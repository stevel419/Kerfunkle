<div class="shopease-cart-page" id="cart-page-content">
  <% if @cart_items.empty? %>
    <!-- Empty Cart State -->
    <div class="empty-cart-container">
      <div class="empty-cart-content">
        <div class="empty-cart-image-wrapper">
          <svg class="empty-cart-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <circle cx="9" cy="21" r="1" stroke-width="2"></circle>
            <circle cx="20" cy="21" r="1" stroke-width="2"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </div>
        <h1 class="empty-cart-title">Your cart is empty</h1>
        <p class="empty-cart-text">Looks like you haven't added any items to your cart yet.</p>
        <%= link_to products_path, class: "empty-cart-button" do %>
          Continue Shopping
        <% end %>
      </div>
    </div>
  <% else %>
    <!-- Cart with Items -->
    <div class="cart-container">
      <h1 class="cart-page-title">Shopping Cart</h1>

      <div class="cart-grid">
        <!-- Cart Items -->
        <div class="cart-items-section">
          <% @cart_items.each_with_index do |item, index| %>
            <%= render partial: "cart/cart_item", locals: { item: item, index: index } %>
          <% end %>
        </div>

        <!-- Order Summary -->
        <div class="order-summary-section" id="order-summary">
          <%= render partial: "cart/order_summary", locals: { cart_items: @cart_items } %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<style>
/* ShopEase Cart Page Styles */
.shopease-cart-page {
  min-height: calc(100vh - 56px);
  background: #f8f9fa;
}

/* Empty Cart State */
.empty-cart-container {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: calc(100vh - 56px);
  padding: 2rem;
}

.empty-cart-content {
  max-width: 400px;
  text-align: center;
  animation: fadeIn 0.6s ease-out;
}

.empty-cart-image-wrapper {
  margin-bottom: 2rem;
}

.empty-cart-icon {
  width: 100px;
  height: 100px;
  margin: 0 auto;
  color: #9ca3af;
}

.empty-cart-title {
  font-size: 1.75rem;
  font-weight: 700;
  margin-bottom: 0.75rem;
  color: hsl(var(--foreground));
}

.empty-cart-text {
  color: hsl(var(--muted-foreground));
  margin-bottom: 2rem;
  font-size: 1rem;
}

.empty-cart-button {
  display: inline-block;
  padding: 0.75rem 2rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  font-weight: 600;
  border-radius: 0.5rem;
  text-decoration: none;
  transition: all 0.3s;
}

.empty-cart-button:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
}

/* Cart with Items */
.cart-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem 1rem;
}

.cart-page-title {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 2rem;
  color: hsl(var(--foreground));
  animation: fadeIn 0.6s ease-out;
}

.cart-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 2rem;
}

@media (min-width: 1024px) {
  .cart-grid {
    grid-template-columns: 2fr 1fr;
  }
}

.cart-items-section {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.cart-item-card {
  background: white;
  border: 1px solid hsl(var(--border));
  border-radius: 0.75rem;
  padding: 1.5rem;
  transition: all 0.3s ease-out;
  animation: fadeInUp 0.5s ease-out;
  animation-fill-mode: both;
}

/* Smooth update animation when quantity changes */
@keyframes subtleUpdate {
  0% { background: white; }
  50% { background: #f0f9ff; }
  100% { background: white; }
}

/* Apply subtle animation on turbo frame updates */
turbo-frame[id^="cart-item-"] {
  display: contents;
}

.cart-item-card.updating {
  animation: subtleUpdate 0.6s ease-out;
}

.cart-item-card[data-item-index="0"] { animation-delay: 0s; }
.cart-item-card[data-item-index="1"] { animation-delay: 0.1s; }
.cart-item-card[data-item-index="2"] { animation-delay: 0.15s; }
.cart-item-card[data-item-index="3"] { animation-delay: 0.2s; }

.cart-item-card:hover {
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
  transform: translateY(-2px);
}

.cart-item-content {
  display: flex;
  gap: 1.5rem;
}

.cart-item-image-wrapper {
  flex-shrink: 0;
  width: 100px;
  height: 100px;
  border-radius: 0.5rem;
  overflow: hidden;
  background: #f3f4f6;
}

.cart-item-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s;
}

.cart-item-image-wrapper:hover .cart-item-image {
  transform: scale(1.1);
}

.cart-item-details {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.cart-item-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.cart-item-title {
  flex: 1;
}

.cart-item-link {
  font-size: 1.125rem;
  font-weight: 600;
  color: hsl(var(--foreground));
  text-decoration: none;
  transition: color 0.2s;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.cart-item-link:hover {
  color: hsl(var(--primary));
}

.cart-item-remove-btn {
  flex-shrink: 0;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
  background: transparent;
  color: #6b7280;
  cursor: pointer;
  border-radius: 0.5rem;
  transition: all 0.2s;
}

.cart-item-remove-btn:hover {
  background: #fee2e2;
  color: #dc2626;
  transform: scale(1.1);
}

.cart-item-price {
  font-size: 1.5rem;
  font-weight: 700;
  color: #10b981;
}

.cart-item-stock {
  font-size: 0.875rem;
  color: #10b981;
}

.cart-item-out-of-stock {
  font-size: 0.875rem;
  color: #dc2626;
  animation: pulse 2s infinite;
}

.cart-item-quantity-controls {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.quantity-form {
  display: inline-flex;
}

.quantity-btn {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid hsl(var(--border));
  background: white;
  color: hsl(var(--foreground));
  cursor: pointer;
  border-radius: 0.375rem;
  transition: all 0.2s;
}

.quantity-btn:hover:not(:disabled) {
  background: hsl(var(--accent));
  transform: scale(1.1);
}

.quantity-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.quantity-input {
  width: 60px;
  height: 36px;
  text-align: center;
  border: 1px solid hsl(var(--border));
  border-radius: 0.375rem;
  font-weight: 600;
  line-height: 36px;
  padding: 0;
  font-size: 1rem;
}

.cart-item-total-price {
  text-align: right;
  align-self: flex-start;
}

.item-total-amount {
  font-size: 1.25rem;
  font-weight: 700;
  color: hsl(var(--foreground));
}

/* Order Summary */
.order-summary-section {
  height: fit-content;
}

@media (min-width: 1024px) {
  .order-summary-section {
    position: sticky;
    top: 76px;
  }
}

.order-summary-card {
  background: white;
  border: 1px solid hsl(var(--border));
  border-radius: 0.75rem;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  transition: box-shadow 0.3s;
  animation: fadeIn 0.6s ease-out;
}

.order-summary-card:hover {
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.order-summary-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1.5rem;
  border-bottom: 1px solid hsl(var(--border));
}

.order-summary-title {
  font-size: 1.25rem;
  font-weight: 700;
  color: hsl(var(--foreground));
}

.order-summary-content {
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.summary-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.summary-label {
  color: hsl(var(--muted-foreground));
}

.summary-value {
  font-weight: 600;
  color: hsl(var(--foreground));
}

.summary-value.free-shipping {
  color: #10b981;
}

.summary-divider {
  height: 1px;
  background: hsl(var(--border));
  margin: 0.5rem 0;
}

.summary-total {
  margin-top: 0.5rem;
}

.summary-total-label {
  font-weight: 700;
  font-size: 1.125rem;
  color: hsl(var(--foreground));
}

.summary-total-value {
  font-weight: 700;
  font-size: 1.5rem;
  color: #10b981;
}

.shipping-notice {
  margin-top: 0.5rem;
  padding: 0.75rem 1rem;
  background: #dbeafe;
  border: 1px solid #93c5fd;
  border-radius: 0.5rem;
}

.shipping-notice p {
  font-size: 0.875rem;
  color: #1e40af;
  margin: 0;
}

.order-summary-footer {
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.checkout-button {
  width: 100%;
  padding: 0.875rem 1.5rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  font-weight: 600;
  border: none;
  border-radius: 0.5rem;
  text-align: center;
  text-decoration: none;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 1rem;
}

.checkout-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
}

.continue-shopping-button {
  width: 100%;
  padding: 0.875rem 1.5rem;
  background: white;
  color: hsl(var(--foreground));
  font-weight: 600;
  border: 1px solid hsl(var(--border));
  border-radius: 0.5rem;
  text-align: center;
  text-decoration: none;
  cursor: pointer;
  transition: all 0.3s;
}

.continue-shopping-button:hover {
  background: hsl(var(--accent));
  transform: scale(1.05);
}

/* Animations */
@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Toast Notification */
.toast-notification {
  position: fixed;
  top: 80px;
  right: 20px;
  padding: 1rem 1.5rem;
  border-radius: 0.5rem;
  font-weight: 600;
  font-size: 0.95rem;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  z-index: 9999;
  opacity: 0;
  transform: translateX(400px);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  max-width: 400px;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.toast-notification.show {
  opacity: 1;
  transform: translateX(0);
}

.toast-notification.toast-notice {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: white;
}

.toast-notification.toast-alert {
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  color: white;
}

/* Responsive Toast */
@media (max-width: 768px) {
  .toast-notification {
    top: 10px;
    right: 10px;
    left: 10px;
    max-width: none;
    transform: translateY(-100px);
  }
  
  .toast-notification.show {
    transform: translateY(0);
  }
}

/* Responsive */
@media (max-width: 768px) {
  .cart-item-content {
    flex-direction: column;
  }

  .cart-item-image-wrapper {
    width: 100%;
    height: 200px;
  }

  .cart-item-total-price {
    text-align: left;
  }
}
</style>

<script>
// Toast notification function
function showToast(message, type = 'notice') {
  // Remove any existing toasts
  const existingToast = document.querySelector('.toast-notification');
  if (existingToast) {
    existingToast.remove();
  }

  // Create toast element
  const toast = document.createElement('div');
  toast.className = `toast-notification toast-${type}`;
  toast.textContent = message;
  
  // Add to page
  document.body.appendChild(toast);
  
  // Trigger animation
  setTimeout(() => {
    toast.classList.add('show');
  }, 10);
  
  // Remove after 3 seconds
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => {
      toast.remove();
    }, 300);
  }, 3000);
}

// Intercept cart item delete button clicks
document.addEventListener('submit', (event) => {
  const form = event.target;
  
  // Check if this is a cart item delete form
  if (form.dataset.cartItemDelete === 'true') {
    event.preventDefault();
    
    const productName = form.dataset.productName;
    const formData = new FormData(form);
    
    // Show red toast immediately for deletion
    showToast(`${productName} removed from cart`, 'alert');
    
    // Submit the form via fetch
    fetch(form.action, {
      method: form.method,
      body: formData,
      headers: {
        'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content,
        'Accept': 'text/vnd.turbo-stream.html'
      }
    })
    .then(response => response.text())
    .then(html => {
      // Process the turbo stream response
      Turbo.renderStreamMessage(html);
    })
    .catch(error => {
      console.error('Error removing item:', error);
      showToast('Error removing item from cart', 'alert');
    });
  }
});

// Add subtle visual feedback when cart items update
document.addEventListener('turbo:before-stream-render', (event) => {
  const target = event.target;
  
  // Check if this is a cart item update
  if (target && target.target && target.target.startsWith('cart-item-')) {
    const existingElement = document.getElementById(target.target);
    if (existingElement) {
      // Add updating class for smooth transition
      existingElement.classList.add('updating');
      
      // Remove class after animation completes
      setTimeout(() => {
        const newElement = document.getElementById(target.target);
        if (newElement) {
          newElement.classList.remove('updating');
        }
      }, 600);
    }
  }
});

// Provide visual feedback on button clicks
document.addEventListener('click', (event) => {
  const button = event.target.closest('.quantity-btn');
  if (button && !button.disabled) {
    // Add a subtle scale effect
    button.style.transform = 'scale(0.95)';
    setTimeout(() => {
      button.style.transform = '';
    }, 150);
  }
});
</script>
