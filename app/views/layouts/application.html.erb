<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Kerfunkle - Your Ultimate Party Supply Destination" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/imgs/letter-logo.png" type="image/png">
    <link rel="apple-touch-icon" href="/imgs/letter-logo.png">

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="shopease-layout <%= 'auth-page' if controller_name == 'sessions' %>">
    <% if controller_name == 'sessions' %>
      <!-- Auth Page Layout (No Sidebar/Header/Footer) -->
      <main class="min-h-screen">
        <%= yield %>
      </main>
    <% else %>
      <!-- Standard App Layout (With Sidebar/Header/Footer) -->
      <div class="flex min-h-screen w-full" data-sidebar-state="expanded">
      <!-- Sidebar -->
        <aside class="sidebar group expanded" id="sidebar" data-state="expanded" data-collapsible="icon">    
      <!-- Sidebar Header -->
      <div class="sidebar-header">
        <%= link_to root_path, class: "sidebar-logo" do %>
          <!-- Full logo (expanded only) -->
          <%= image_tag "/imgs/logo.png", alt: "Kerfunkle", class: "logo-full" %>
          <!-- Letter logo (collapsed only) -->
          <%= image_tag "/imgs/letter-logo.png", alt: "K", class: "logo-mini" %>
        <% end %>
      </div>

        <!-- Sidebar Content -->
        <div class="sidebar-content">
          <!-- Shop Section -->
          <div class="sidebar-group">
            <div class="sidebar-group-label">Shop</div>
            <nav class="sidebar-menu">
              <%= link_to root_path, class: "sidebar-menu-item #{current_page?(root_path) ? 'active' : ''}", title: "Home" do %>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="menu-icon">
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                  <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span class="menu-text">Home</span>
              <% end %>
              
              <%= link_to products_path, class: "sidebar-menu-item #{current_page?(products_path) ? 'active' : ''}", title: "Products" do %>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="menu-icon">
                  <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
                  <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                  <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                  <line x1="12" y1="22.08" x2="12" y2="12"></line>
                </svg>
                <span class="menu-text">Products</span>
              <% end %>
              
              <%= link_to cart_path, class: "sidebar-menu-item #{current_page?(cart_path) ? 'active' : ''}", title: "Cart" do %>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="menu-icon">
                  <circle cx="9" cy="21" r="1"></circle>
                  <circle cx="20" cy="21" r="1"></circle>
                  <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                <span class="menu-text">Cart</span>
                <% if (cart = cart_for_current_context) && cart.cart_items.any? %>
                  <span class="sidebar-badge"><%= cart.cart_items.sum(:quantity) %></span>
                <% end %>
              <% end %>
            </nav>
          </div>

          <!-- Account Section -->
          <% if current_user %>
            <div class="sidebar-separator"></div>
            <div class="sidebar-group">
              <div class="sidebar-group-label">Account</div>
              <nav class="sidebar-menu">
                <%= link_to dashboard_path, class: "sidebar-menu-item #{current_page?(dashboard_path) ? 'active' : ''}", title: "Dashboard" do %>
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="menu-icon">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  <span class="menu-text">Dashboard</span>
                <% end %>
                
                <%= link_to orders_path, class: "sidebar-menu-item #{current_page?(orders_path) ? 'active' : ''}", title: "Orders" do %>
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="menu-icon">
                    <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                    <line x1="12" y1="22.08" x2="12" y2="12"></line>
                  </svg>
                  <span class="menu-text">Orders</span>
                <% end %>
              </nav>
            </div>
          <% end %>
        </div>

        <!-- Sidebar Footer -->
        <div class="sidebar-footer">
          <% if current_user %>
            <div class="sidebar-user">
              <div class="sidebar-user-info">
                <div class="sidebar-user-name"><%= current_user.email %></div>
              </div>
              <%= button_to logout_path, method: :delete, class: "sidebar-logout-btn" do %>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                  <polyline points="16 17 21 12 16 7"></polyline>
                  <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                <span>Logout</span>
              <% end %>
            </div>
          <% else %>
            <%= link_to login_path, class: "sidebar-login-btn" do %>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                <polyline points="10 17 15 12 10 7"></polyline>
                <line x1="15" y1="12" x2="3" y2="12"></line>
              </svg>
              <span>Login</span>
            <% end %>
          <% end %>
        </div>
      </aside>

      <!-- Main Content Area -->
      <div class="flex-1 flex flex-col">
        <!-- Header -->
        <header class="shopease-header">
          <div class="header-content">
            <!-- Sidebar Toggle Button (for all screen sizes) -->
            <button type="button" class="sidebar-trigger" id="sidebarTrigger" aria-label="Toggle sidebar">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="9" y1="3" x2="9" y2="21"></line>
              </svg>
            </button>
            
            <!-- Search Bar (Not currently implemented)-->
            <!-- <div class="header-search-wrapper">
              <svg class="header-search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
              <input type="search" placeholder="Search products..." class="header-search-input" />
            </div> -->

            <!-- Right Side Actions -->
            <div class="header-actions">
              <%= link_to cart_path, class: "header-cart-btn" do %>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="9" cy="21" r="1"></circle>
                  <circle cx="20" cy="21" r="1"></circle>
                  <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                <span id="cart-badge">
                  <% if (cart = cart_for_current_context) && cart.cart_items.any? %>
                    <span class="header-badge"><%= cart.cart_items.sum(:quantity) %></span>
                  <% end %>
                </span>
              <% end %>

              <% if current_user %>
                <%= link_to dashboard_path, class: "header-user-btn" do %>
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                <% end %>
              <% else %>
                <%= link_to login_path, class: "header-login-btn" do %>
                  Login
                <% end %>
              <% end %>
            </div>
          </div>
        </header>

        <!-- Flash Messages -->
        <% if flash.any? %>
          <div class="flash-container">
            <% flash.each do |type, message| %>
              <div class="flash-message flash-<%= type %>">
                <%= message %>
              </div>
            <% end %>
          </div>
        <% end %>

        <!-- Main Content -->
        <main class="shopease-main">
          <%= yield %>

          <!-- Footer -->
          <footer class="app-footer">
            <div class="footer-container">
              <div class="footer-top">
                <!-- Left: Logo -->
                <div class="footer-left-section">
                  <%= link_to root_path do %>
                    <%= image_tag "/imgs/logo.png", alt: "Kerfunkle", class: "footer-logo" %>
                  <% end %>
                </div>
                
                <!-- Center: Navigation -->
                <nav class="footer-nav">
                  <%= link_to "Home", root_path, class: "footer-nav-link" %>
                  <%= link_to "Products", products_path, class: "footer-nav-link" %>
                  <%= link_to "Cart", cart_path, class: "footer-nav-link" %>
                </nav>
                
                <!-- Right: Social Media & Contact -->
                <div class="footer-right-section">
                  <div class="footer-social">
                    <a href=# target="_blank" rel="noopener" class="social-icon" title="TikTok">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
                      </svg>
                    </a>
                    <a href=# target="_blank" rel="noopener" class="social-icon" title="Instagram">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                        <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                        <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                      </svg>
                    </a>
                    <a href=# target="_blank" rel="noopener" class="social-icon" title="YouTube">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                      </svg>
                    </a>
                    <a href=# target="_blank" rel="noopener" class="social-icon" title="X (Twitter)">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                      </svg>
                    </a>
                  </div>
                  <div class="footer-contact">
                    <a href="mailto:officialkerfunkle@gmail.com" class="contact-email">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                      </svg>
                      officialkerfunkle@gmail.com
                    </a>
                  </div>
                </div>
              </div>
              
              <div class="footer-divider"></div>
              
              <div class="footer-bottom">
                <div class="footer-copyright">
                  <p>&copy; <%= Date.current.year %> Kerfunkle. All rights reserved.</p>
                </div>
                <div class="footer-links">
                  <%= link_to "Privacy Policy", privacy_policy_path, class: "footer-link" %>
                  <%= link_to "Refund Policy", refund_policy_path, class: "footer-link" %>
                  <%= link_to "Terms of Service", terms_of_service_path, class: "footer-link" %>
                </div>
              </div>
            </div>
          </footer>
        </main>
      </div>
    <% end %>
  </body>
</html>
